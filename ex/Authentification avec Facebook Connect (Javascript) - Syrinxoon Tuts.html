<!DOCTYPE html>
<!-- saved from url=(0080)http://tuts.syrinxoon.net/tuts/authentification-avec-facebook-connect-javascript -->
<html itemscope="" itemtype="http://schema.org/Article"><meta style="visibility: hidden !important; display: block !important; width: 0px !important; height: 0px !important; border-style: none !important;"><object id="__IDM__" type="application/x-idm-downloader" width="1" height="1" style="visibility: hidden !important; display: block !important; width: 1px !important; height: 1px !important; border-style: none !important; position: absolute !important; top: 0px !important; left: 0px !important;"></object></meta><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# sxntuts: http://ogp.me/ns/fb/sxntuts#"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <script type="text/javascript" async="" src="./Authentification avec Facebook Connect (Javascript) - Syrinxoon Tuts_files/ga.js"></script><script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"b1d6ab850dc059772cc079cc8458b3e9",petok:"0ef9b11ea6c2d99544f741c033727ff8915dc2cb-1423582674-1800",zone:"syrinxoon.net",rocket:"a",apps:{"clky":{"sid":"66563991","uid":"0"},"ga_key":{"ua":"UA-13033279-1","ga_bs":"2"}}}];CloudFlare.push({"apps":{"ape":"83c1c886c37aaea6bdcc54c6125e2185"}});document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=919620257c/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script><script type="text/javascript" src="./Authentification avec Facebook Connect (Javascript) - Syrinxoon Tuts_files/cloudflare.min.js"></script><style type="text/css">.cf-hidden { display: none; } .cf-invisible { visibility: hidden; }</style><script data-module="cloudflare/rocket" id="cfjs_block_1228e047c47" onload="CloudFlare.__cfjs_block_1228e047c47_load()" onerror="CloudFlare.__cfjs_block_1228e047c47_error()" onreadystatechange="CloudFlare.__cfjs_block_1228e047c47_readystatechange()" type="text/javascript" src="./Authentification avec Facebook Connect (Javascript) - Syrinxoon Tuts_files/rocket.js"></script>

<!--[if lt IE 9]>
<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
<![endif]-->
<link href="./Authentification avec Facebook Connect (Javascript) - Syrinxoon Tuts_files/application-7bb268662d82abbf3f8999ed87a58230.css" media="screen" rel="stylesheet" type="text/css">

<meta content="authenticity_token" name="csrf-param">
<meta content="BBcGSURg53DOuz+r3unLy+k4OTLDQGdEtZnWbybg7rI=" name="csrf-token">
<link href="http://tuts.syrinxoon.net/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon">
<link href="http://feeds.feedburner.com/syrinxoontuts" rel="alternate" title="Flux des tutoriels" type="application/atom+xml">
<link href="https://plus.google.com/110111273495796671092/" rel="publisher">
<meta charset="utf-8">
<title>Authentification avec Facebook Connect (Javascript) - Syrinxoon Tuts</title>
<meta content="Authentification avec Facebook Connect (Javascript) - Syrinxoon Tuts" itemprop="name">
<meta content="Authentifier vos utilisateurs via Facebook Connect est une chose très simple grâce au [SDK Javascript](https://developers.facebook.com/docs/referen..." name="description">
<meta content="facebook, connect, api, javascript, authentification, connexion, syrinxoon, tuts, informatique, programmation, web, ruby, rails, php, javascript, jquery, api, framework, mac, os x, linux, logiciel, programme, serveur, web" name="keywords">
<meta content="143854381048" property="fb:app_id">
<meta content="Authentifier vos utilisateurs via Facebook Connect est une chose très simple grâce au [SDK Javascript](https://developers.facebook.com/docs/referen..." property="og:description">
<meta content="Authentifier vos utilisateurs via Facebook Connect est une chose très simple grâce au [SDK Javascript](https://developers.facebook.com/docs/referen..." itemprop="description">
<meta content="Nathan Le Ray" name="author">
<meta content="http://tuts.syrinxoon.net/system/images/5/medium/facebook-connect.png?1330382390" itemprop="image">
<meta content="sxntuts:tutorial" property="og:type">
<meta content="http://tuts.syrinxoon.net/tuts/authentification-avec-facebook-connect-javascript" property="og:url">
<meta content="Authentification avec Facebook Connect (Javascript)" property="og:title">
<meta content="http://tuts.syrinxoon.net/system/images/5/medium/facebook-connect.png?1330382390" property="og:image">
<meta content="2013-05-21 09:40:13 +0200" property="og:updated_time">
<meta content="Nathan Le Ray" property="sxntuts:author">
<meta content="API" property="sxntuts:category">
<meta content="summary_large_image" name="twitter:card">
<meta content="@sxntuts" name="twitter:site">
<meta content="@oyokoon" name="twitter:creator">
<meta content="Authentification avec Facebook Connect (Javascript)" name="twitter:title">
<meta content="Authentifier vos utilisateurs via Facebook Connect est une chose très simple grâce au [SDK Javascript](https://developers.facebook.com/docs/reference/javascript/) que met Facebook à notre dispos..." name="twitter:description">
<meta content="http://tuts.syrinxoon.net/system/features/5/thumb/facebook-connect.png?1330380818" name="twitter:image:src">
<meta content="syrinxoon.net" name="twitter:domain">
<meta content="q0xFhU7u-pppCei39e8nIFp9JIQVz8Qz9T4KkvK4RNA" name="google-site-verification">
<meta content="width=device-width, initial-scale=1.0" name="viewport">

<script type="text/javascript">
/* <![CDATA[ */
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-13033279-1']);
_gaq.push(['_trackPageview']);

(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

(function(b){(function(a){"__CF"in b&&"DJS"in b.__CF?b.__CF.DJS.push(a):"addEventListener"in b?b.addEventListener("load",a,!1):b.attachEvent("onload",a)})(function(){"FB"in b&&"Event"in FB&&"subscribe"in FB.Event&&(FB.Event.subscribe("edge.create",function(a){_gaq.push(["_trackSocial","facebook","like",a])}),FB.Event.subscribe("edge.remove",function(a){_gaq.push(["_trackSocial","facebook","unlike",a])}),FB.Event.subscribe("message.send",function(a){_gaq.push(["_trackSocial","facebook","send",a])}));"twttr"in b&&"events"in twttr&&"bind"in twttr.events&&twttr.events.bind("tweet",function(a){if(a){var b;if(a.target&&a.target.nodeName=="IFRAME")a:{if(a=a.target.src){a=a.split("#")[0].match(/[^?=&]+=([^&]*)?/g);b=0;for(var c;c=a[b];++b)if(c.indexOf("url")===0){b=unescape(c.split("=")[1]);break a}}b=void 0}_gaq.push(["_trackSocial","twitter","tweet",b])}})})})(window);
/* ]]> */
</script>
<script type="text/javascript" async="" src="./Authentification avec Facebook Connect (Javascript) - Syrinxoon Tuts_files/in.php"></script></head>
<body><script type="text/javascript">
//<![CDATA[
try{(function(a){var b="http://",c="tuts.syrinxoon.net",d="/cdn-cgi/cl/",e="img.gif",f=new a;f.src=[b,c,d,e].join("")})(Image)}catch(e){}
//]]>
</script>
<div id="fb-root"></div>

<nav class="navbar navbar-fixed-top">
<div class="navbar-inner">
<div class="container">
<a href="http://tuts.syrinxoon.net/tuts/authentification-avec-facebook-connect-javascript#" class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></a>
<a href="http://tuts.syrinxoon.net/" class="brand" id="logo">Syrinxoon Tuts</a>
<div class="nav-collapse">
<form accept-charset="UTF-8" action="http://tuts.syrinxoon.net/tuts" class="navbar-search pull-left" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"></div>
<input class="search-query" id="search" name="search" placeholder="Rechercher des tutoriels" type="text">
</form>
<ul class="nav">
<li><a href="http://tuts.syrinxoon.net/categories">Catégories</a></li>
<li><a href="http://tuts.syrinxoon.net/tuts">Tutoriels</a></li>
<li><a href="http://tuts.syrinxoon.net/about">A propos</a></li>
<li><a href="http://feeds.feedburner.com/syrinxoontuts">Flux RSS</a></li>
</ul>
<ul class="nav pull-right">
<li class="dropdown">
<a href="http://tuts.syrinxoon.net/tuts/authentification-avec-facebook-connect-javascript#" class="dropdown-toggle" data-toggle="dropdown">Compte <b class="caret"></b></a>
<ul class="dropdown-menu">
<li><a href="http://tuts.syrinxoon.net/login">Connexion</a></li>
<li><a href="http://tuts.syrinxoon.net/signup">Inscription</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</nav>
<header class="masthead">
<div class="container">
<div class="inner">
<h1>Authentification avec Facebook Connect (Javascript)</h1>
</div>
</div>
</header>
<div class="container">
<section class="row">
<div class="span9" id="content">
<div id="tutorial-content">
<div class="page-header">
<h1 id="introduction">
Introduction
<small>Le but de ce tutoriel et ce que vous allez apprendre.</small>
</h1>
</div>
<p></p><p>Authentifier vos utilisateurs via Facebook Connect est une chose très simple grâce au <a href="https://developers.facebook.com/docs/reference/javascript/">SDK Javascript</a> que met Facebook à notre disposition.
Il ne vous faudra que quelques minutes et un peu de Javascript pour effectuer cette tâche.
Commençons sans plus tarder.</p><p></p>
<br>
<div class="page-header">
<h1 id="creation-de-l-application">
Création de l'application
<small>Enregistrement sur Facebook</small>
</h1>
</div>
<p></p><p>Avant de pouvoir authentifier vos utilisateurs avec Facebook, vous allez devoir créer une application sur le site de Facebook.
Pour se faire, rendez vous sur <a href="https://developers.facebook.com/apps">cette page</a> puis cliquez sur le bouton <strong>Create New App</strong> en haut à droite avant de completer les informations demandées. </p>

<p></p><div class="center well"><a href="http://tuts.syrinxoon.net/system/pictures/6/original/step01.png?1330383011" class="fancybox-button" title="Nom de l" application="" rel="fancybox-button"><img src="./Authentification avec Facebook Connect (Javascript) - Syrinxoon Tuts_files/step01.png" alt="Nom de l&#39;application"></a></div><p></p>

<p>Une fois votre application créée, vous pouvez compléter quelques informations supplémentaires en vous rendant dans les paramètres de l'application.</p>

<p></p><div class="center well"><a href="http://tuts.syrinxoon.net/system/pictures/9/original/step04.png?1330383023" class="fancybox-button" title="Détails de l" application="" rel="fancybox-button"><img src="./Authentification avec Facebook Connect (Javascript) - Syrinxoon Tuts_files/step04.png" alt="Détails de l&#39;application"></a></div><p></p>

<p>Le fait d'avoir un logo et une petite description fait un peu plus sérieux.
Rendez vous ensuite dans l'onglet <strong>Web Site</strong>. Vous y trouverez deux clés et deux champs. Remplissez au moins le premier champ (Site URL), Facebook s'en servira lors de l'authentification des utilisateurs. La clé qui nous intéresse est <strong>Application ID</strong>. Notez là quelque part, on va en avoir besoin. </p><p></p>
<div class="page-header">
<h1 id="installation-des-fichiers-necessaires">
Installation des fichiers nécessaires
<small>Pour communiquer avec Facebook</small>
</h1>
</div>
<p></p><p>Ouvrez la page sur laquelle vous souhaitez que les utilisateurs puissent se connecter dans votre editeur de texte. Ajoutez le code suivant dans votre page. </p>

<div class="highlight">
<pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"fb-root"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"http://connect.facebook.net/fr_FR/all.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>
    <span class="nx">FB</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
        <span class="nx">appId</span>  <span class="o">:</span> <span class="s1">'VOTRE_APPLICATION_ID'</span><span class="p">,</span>
        <span class="nx">status</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// verifie le statut de la connexion</span>
        <span class="nx">cookie</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// active les cookies pour que le serveur puisse accéder à la session</span>
        <span class="nx">xfbml</span>  <span class="o">:</span> <span class="kc">true</span>  <span class="c1">// active le XFBML (HTML de Facebook)</span>
    <span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
</pre>
</div>


<p>Le bloc ayant l'id <strong>fb-root</strong> sert à Facebook pour stocker des éléments, il ne nous intéresse pas mais il doit impérativement être placé avant les balises <strong></strong>.
Nous appellons ensuite le SDK Javascript. Notez dans l'url le <strong>fr_FR</strong>. Ce paramètre sert à définir la langue dans laquelle Facebook affichera la fenêtre de connexion, le bouton de connexion, etc. Si vous souhaitez que Facebook communique en anglais, mettez <strong>en_US</strong>.</p>

<p>La seconde balise <strong></strong> accueillera tout le reste de notre code Javascript.
Pour le moment, notre code contient une seule fonction : <strong>FB.init()</strong>. Cette fonction se charge d'initialiser le SDK, elle prend <strong>4</strong> paramètres.</p>

<ul>
<li>
<strong>appId</strong> : votre identifiant d'application</li>
<li>
<strong>status</strong> : vérifier si un l'utilisateur est connecté à Facebook</li>
<li>
<strong>cookie</strong> : enregistrer la session dans un cookie (permet de lire les données avec PHP par exemple)</li>
<li>
<strong>xfbml</strong> : convertir le XFBML en HTML</li>
</ul>
<p>Je vous conseille de laisser les 3 derniers paramètres à <strong>true</strong> (activé).</p>

<p>Maintenant que le SDK est chargé et initialisé, nous allons pouvoir afficher le bouton de connexion à Facebook. </p>

<p></p><div class="center well"><a href="http://tuts.syrinxoon.net/system/pictures/36/original/login-button.png?1333811569" class="fancybox-button" title="Bouton de connexion" rel="fancybox-button"><img src="./Authentification avec Facebook Connect (Javascript) - Syrinxoon Tuts_files/login-button.png" alt="Bouton de connexion"></a></div><p></p>

<p>Insérez le code suivant à l'endroit où vous souhaitez que le bouton de connexion soit affiché. </p>

<div class="highlight">
<pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"box"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"social_networks"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"facebook_button_box"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;fb:login</span><span class="na">-button</span> <span class="na">show-faces=</span><span class="s">"true"</span> <span class="na">width=</span><span class="s">"450"</span> <span class="na">perms=</span><span class="s">"email,user_birthday,read_stream"</span><span class="nt">&gt;</span><span class="err">&lt;</span>/fb:login-button&gt;
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"social_networks_profiles"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"facebook_profile"</span> <span class="na">style=</span><span class="s">"display:none;"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"facebook_profile_image"</span> <span class="na">style=</span><span class="s">"width:50px;height:50px;margin-left:20px;float:left;"</span><span class="nt">&gt;</span>

            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"facebook_profile_text"</span> <span class="na">style=</span><span class="s">"height:50px;margin-top:-3px;margin-left:5px;float:left"</span><span class="nt">&gt;</span>

            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"clear"</span><span class="nt">&gt;&lt;/div&gt;</span>
            <span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">"facebook_user_data"</span><span class="nt">&gt;</span>

            <span class="nt">&lt;/ul&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"clear"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre>
</div>


<p>Ce code est celui de la page de démonstration, si vous souhaitez juste afficher le bouton de connexion, utilisez le code suivant : </p>

<div class="highlight">
<pre><span class="nt">&lt;fb:login</span><span class="na">-button</span> <span class="na">show-faces=</span><span class="s">"true"</span> <span class="na">width=</span><span class="s">"450"</span> <span class="na">perms=</span><span class="s">"email,user_birthday,read_stream"</span><span class="nt">&gt;</span><span class="err">&lt;</span>/fb:login-button&gt;
</pre>
</div>


<p>Vous pouvez personnaliser ce bouton sur <a href="https://developers.facebook.com/docs/reference/plugins/login/">cette page</a>.
Je vais succinctement détailler mon code HTML. Tout le code est contenu dans une boîte principale ayant la classe <strong>.box</strong>. Cette boîte en contient deux autres : <strong>#facebook_button_box</strong> et <strong>#social_networks_profiles #facebook_profile</strong>. La première contient le bouton de connexion et est affichée lorsque l'utilisateur n'est pas connecté. La seconde contient les informations sur l'utilisateur et n'est affichée que lorsque l'utilisateur est connecté (à quoi bon l'afficher sinon ?!).
Lorsque l'utilisateur est connecté, les rôles s'inversent. On cache la boîte contenant le bouton de connexion et on affiche celle contenant les informations de l'utilisateur.</p>

<p>Revenons au bouton de connexion. Il contient plusieurs attributs :</p>

<ul>
<li>
<strong>show-faces</strong> : les amis de l'utilisateur qui utilisent l'application sont affichés lorsque ce dernier n'est pas connecté</li>
<li>
<strong>width</strong> : la taille du bloc contenant le bouton et la liste des amis utilisant l'application (ce n'est pas la taille du bouton)</li>
<li>
<strong>perms</strong> : contient la liste des permissions que l'application demande pour accéder aux informations de l'utilisateur</li>
</ul>
<p>L'attribut le plus intéressant est <strong>perms</strong> car il nous permet de demander des autorisations (séparées par une virgule) permettant d'accéder aux informations privées de l'utilisateur. La liste des permissions disponibles est affichée sur <a href="https://developers.facebook.com/docs/reference/api/permissions/">cette page</a>.
Ici, nous demandons plusieurs permissions : </p>

<ul>
<li>
<strong>email</strong> : accéder à l'adresse email de l'utilisateur</li>
<li>
<strong>user_birthday</strong> : accéder à la date de naissance de l'utilisateur</li>
<li>
<strong>read_stream</strong> : accéder aux derniers statuts de l'utilisateur</li>
</ul>
<p>Il y a bien d'autres permissions disponibles permettant de publier des messages, aimer des pages, etc, mais ils ne nous intéressent pas ici.</p>

<p>Nous sommes maintenant parés à authentifier nos utilisateurs. </p><p></p>
<div class="page-header">
<h1 id="authentification">
Authentification
<small>De nos utilisateurs</small>
</h1>
</div>
<p></p><p>Lorsqu'un utilisateur arrive sur la page, il y a 4 cas possibles :</p>

<ol>
<li>L'utilisateur n'est pas connecté à Facebook et n'a pas autorisé l'application</li>
<li>L'utilisateur n'est pas connecté à Facebook et a déjà autorisé l'application</li>
<li>L'utilisateur est connecté à Facebook et n'a pas autorisé l'application</li>
<li>L'utilisateur est connecté à Facebook et a déjà autorisé l'application</li>
</ol>
<p>L'utilisateur se verra donc afficher les fenêtres suivantes : </p>

<p></p><div class="center well"><a href="http://tuts.syrinxoon.net/system/pictures/37/original/signin-form.png?1333811653" class="fancybox-button" title="Cas 1 et 2" rel="fancybox-button"><img src="./Authentification avec Facebook Connect (Javascript) - Syrinxoon Tuts_files/signin-form.png" alt="Cas 1 et 2"></a></div><p></p>

<p></p><div class="center well"><a href="http://tuts.syrinxoon.net/system/pictures/38/original/allow.png?1333811653" class="fancybox-button" title="Cas 1 et 3" rel="fancybox-button"><img src="./Authentification avec Facebook Connect (Javascript) - Syrinxoon Tuts_files/allow.png" alt="Cas 1 et 3"></a></div><p></p>

<p>Les cas 1 et 2 seront traités par une fonction et les cas 3 et 4 par une seconde fonction.</p>

<p>Commençons par la fonction qui va connecter l'utilisateur à Facebook lorsqu'il est déconnecté. </p>

<div class="highlight">
<pre><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">FB</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">'auth.login'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Code à executer lorsque l'utilisateur se connecte</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre>
</div>


<p>J'encadre le code avec <strong>$(document).ready(function() {});</strong> car j'utiliserai jQuery par la suite. Je m'assure donc que le code ne s'executera qu'une fois la page complètement chargée.</p>

<p>Nous avons donc notre première fonction : <strong>FB.Event.suscribe()</strong>. Cette fonction sert à surveiller des évènements particuliers et relatifs à Facebook sur la page. La liste complète des évènements disponibles est affichée sur <a href="https://developers.facebook.com/docs/reference/javascript/FB.Event.subscribe/">cette page</a>.
Ici, l'évènement que l'on surveille est <strong>auth.login</strong>. Cet évènement est déclenché lorsque l'utilisateur se connecte. Le deuxième paramètre est une fonction de <strong><a href="http://fr.wikipedia.org/wiki/Fonction_de_rappel">callback</a></strong> prenant un paramètre : <strong>response</strong>. Ce paramètre est un objet contenant 3 propriétés mais il ne nous intéresse pas donc je ne le détaillerai pas.</p>

<p>Maintenant que l'utilisateur est connecté, nous allons pouvoir récupérer les informations basiques de l'utilisateur et celles pour lesquelles nous avons demandé une permission.
Pour récupérer ces informations, nous allons devoir une utiliser une autre méthode du SDK : <strong>FB.api()</strong>.
Cette fonction prend deux paramètres : l'url (fonction) de l'API que l'on souhaite intérroger et une fonction de callback qui prend en pramètre une variable contenant la réponse de l'API. L'url vient s'ajouter à <strong><a href="http://graph.facebook.com/">http://graph.facebook.com</a></strong>. Vous trouverez plus d'infos sur la Graph API de Facebook sur <a href="https://developers.facebook.com/docs/reference/api/">cette page</a>.</p>

<p>Nous allons dans un premier temps utiliser l'adresse <strong>/me</strong> pour récupérer les informations basiques de l'utilisateur connecté, à savoir :</p>

<ul>
<li>
<strong>id</strong> : son identifiant (exemple: 11565548)</li>
<li>
<strong>name</strong> : son nom (exemple: Nathan Le Ray)</li>
<li>
<strong>link</strong> : son adresse de profil (exemple: <a href="http://www.facebook.com/nathan.leray">http://www.facebook.com/nathan.leray</a>)</li>
<li>
<strong>bio</strong> : sa biographie (exemple: Si vous me connaissez, vous savez que j'ai peur des souris)</li>
</ul>
<div class="highlight">
<pre><span class="nx">FB</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">'auth.login'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">FB</span><span class="p">.</span><span class="nx">api</span><span class="p">(</span><span class="s1">'/me'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span> 

        <span class="c1">// response est un objet contenant les informations basiques de l'utilisateur</span>

    <span class="p">});</span>

<span class="p">});</span>
</pre>
</div>


<p>L'image de profil de l'utilisateur n'est pas disponible dans les informations basiques mais nous allons pouvoir la récupérer grâce à son identifiant. Ensuite, nous insérons ces informations dans notre page à l'aide de la méthode <strong>html()</strong> de jQuery. </p>

<div class="highlight">
<pre><span class="nx">FB</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">'auth.login'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">FB</span><span class="p">.</span><span class="nx">api</span><span class="p">(</span><span class="s1">'/me'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span> 

        <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">'http://graph.facebook.com/'</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">'/picture'</span><span class="p">;</span>

        <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_profile_image'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'&lt;img src="'</span> <span class="o">+</span> <span class="nx">url</span> <span class="o">+</span> <span class="s1">'" alt="#" /&gt;'</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_profile_text'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'&lt;p&gt;&lt;a href="'</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">link</span> <span class="o">+</span> <span class="s1">'"&gt;&lt;strong&gt;'</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">'&lt;/strong&gt;&lt;/a&gt;&lt;br /&gt;&lt;a href="#" id="facebook_logout"&gt;Deconnexion&lt;/a&gt;'</span><span class="p">);</span>

    <span class="p">});</span>

<span class="p">});</span>
</pre>
</div>


<p>Nous avons demandé lors de la connexion l'accès à l'adresse email et à la date de naissance de l'utilisateur. Ces deux éléments vont donc eux aussi apparaître dans l'objet <strong>response</strong>. </p>

<div class="highlight">
<pre><span class="nx">FB</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">'auth.login'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">FB</span><span class="p">.</span><span class="nx">api</span><span class="p">(</span><span class="s1">'/me'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span> 

        <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">'http://graph.facebook.com/'</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">'/picture'</span><span class="p">;</span>

        <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_profile_image'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'&lt;img src="'</span> <span class="o">+</span> <span class="nx">url</span> <span class="o">+</span> <span class="s1">'" alt="#" /&gt;'</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_profile_text'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'&lt;p&gt;&lt;a href="'</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">link</span> <span class="o">+</span> <span class="s1">'"&gt;&lt;strong&gt;'</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">'&lt;/strong&gt;&lt;/a&gt;&lt;br /&gt;&lt;a href="#" id="facebook_logout"&gt;Deconnexion&lt;/a&gt;'</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">user_data</span> <span class="o">=</span> <span class="s1">'&lt;ul&gt;&lt;li&gt;Votre date de naissance : '</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">birthday</span> <span class="o">+</span> <span class="s1">'&lt;/li&gt;&lt;li&gt;Votre adresse email : '</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">email</span> <span class="o">+</span> <span class="s1">'&lt;/li&gt;&lt;li&gt;Votre bio : '</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">bio</span> <span class="o">+</span> <span class="s1">'&lt;/li&gt;'</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_user_data'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">user_data</span><span class="p">);</span>

    <span class="p">});</span>

<span class="p">});</span>
</pre>
</div>


<p>Nous insérons donc nos puces dans la liste <strong>#facebook_user_data</strong>.
Nous avons donc récupéré les informations de profil de l'utilisateur. Nous allons également récupérer ses 3 derniers statuts.</p>

<p>Nous devons donc appeler une nouvelle fois la fonction <strong>FB.api()</strong> mais avec un premier paramètre différent.
Pour récupérer les status, nous devons appeler l'url <strong>/me/posts</strong> qui retournera par défaut les 25 derniers statuts de l'utilisateur. </p>

<div class="highlight">
<pre><span class="nx">FB</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">'auth.login'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">FB</span><span class="p">.</span><span class="nx">api</span><span class="p">(</span><span class="s1">'/me'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span> 

        <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">'http://graph.facebook.com/'</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">'/picture'</span><span class="p">;</span>

        <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_profile_image'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'&lt;img src="'</span> <span class="o">+</span> <span class="nx">url</span> <span class="o">+</span> <span class="s1">'" alt="#" /&gt;'</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_profile_text'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'&lt;p&gt;&lt;a href="'</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">link</span> <span class="o">+</span> <span class="s1">'"&gt;&lt;strong&gt;'</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">'&lt;/strong&gt;&lt;/a&gt;&lt;br /&gt;&lt;a href="#" id="facebook_logout"&gt;Deconnexion&lt;/a&gt;'</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">user_data</span> <span class="o">=</span> <span class="s1">'&lt;ul&gt;&lt;li&gt;Votre date de naissance : '</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">birthday</span> <span class="o">+</span> <span class="s1">'&lt;/li&gt;&lt;li&gt;Votre adresse email : '</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">email</span> <span class="o">+</span> <span class="s1">'&lt;/li&gt;&lt;li&gt;Votre bio : '</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">bio</span> <span class="o">+</span> <span class="s1">'&lt;/li&gt;'</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_user_data'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">user_data</span><span class="p">);</span>

        <span class="nx">FB</span><span class="p">.</span><span class="nx">api</span><span class="p">(</span><span class="s1">'/me/posts'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>

            <span class="kd">var</span> <span class="nx">messages</span> <span class="o">=</span> <span class="s1">'&lt;li&gt;Vos 3 derniers statuts : &lt;ul&gt;'</span><span class="p">;</span>

            <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>

                <span class="nx">messages</span> <span class="o">+=</span> <span class="s1">'&lt;li&gt;'</span> <span class="o">+</span> <span class="nx">value</span><span class="p">.</span><span class="nx">message</span> <span class="o">+</span> <span class="s1">'&lt;/li&gt;'</span><span class="p">;</span>                           
                <span class="k">return</span> <span class="p">(</span><span class="nx">key</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">);</span>

            <span class="p">});</span> 

            <span class="nx">messages</span> <span class="o">+=</span> <span class="s1">'&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;'</span><span class="p">;</span>

            <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_user_data'</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">messages</span><span class="p">);</span>

        <span class="p">});</span>

    <span class="p">});</span>

<span class="p">});</span>
</pre>
</div>


<p>Ici, <strong>response</strong> est un objet contenant plusieurs sous objets. Nous allons donc parcourir ces objets à l'aide de la méthode <strong>$.each()</strong> de jQuery.
Voici la structure de l'objet response. </p>

<ul>
<li>response

<ul>
<li>data

<ul>
<li>0

<ul>
<li>id</li>
<li>likes</li>
<li>...</li>
<li>message (Le texte du dernier statut)</li>
</ul>
</li>
<li>1

<ul>
<li>id</li>
<li>likes</li>
<li>...</li>
<li>message (Le texte de l'avant dernier statut)</li>
</ul>
</li>
<li>2

<ul>
<li>...</li>
</ul>
</li>
<li>...</li>
<li>24</li>
</ul>
</li>
<li>paging</li>
</ul>
</li>
</ul>
<p>Nous allons donc directement parcourir l'objet <strong>data</strong> qui contient la liste des statuts et récupérer la propriété <strong>message</strong> contenant le texte du statut que nous allons ajouter à notre liste.</p>

<div class="highlight">
<pre><span class="k">return</span> <span class="p">(</span><span class="nx">key</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">);</span>
</pre>
</div>


<p>Cette instruction étrange sert à quitter la boucle each lorsque nous avons listé 3 statuts. On met 2 car key est l'index du tableau data qui commence à 0.
Maintenant que nous avons nos statuts et qu'ils sont insérés dans la page, nous allons pouvoir cacher la boîte contenant le bouton de connexion et afficher celle contenant les informations sur l'utilisateur. Insérez le code suivant juste avant la fin de la fonction <strong>FB.Event.subscribe()</strong>.</p>

<div class="highlight">
<pre><span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_button_box'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
<span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_profile'</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
</pre>
</div>


<p>Et voilà, nous y sommes ! L'utilisateur est maintenant authentifié et nous avons récupéré les informations qui nous intéressaient.</p>

<p>Nous allons maintenant pouvoir aborder le cas (3 et 4) où l'utilisateur est déjà connecté.
Pour se faire, ajoutons la fonction suivante après la première. </p>

<div class="highlight">
<pre><span class="nx">FB</span><span class="p">.</span><span class="nx">getLoginStatus</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">session</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Code à executer si l'utilisateur est connecté</span>
    <span class="p">}</span>

<span class="p">});</span>
</pre>
</div>


<p>La fonction <strong>FB.getLoginStatus()</strong> va vérifier si l'utilisateur est connecté à Facebook et a donné sa permission pour qu'on récupère ses informations. La fonction de callback retourne l'objet response qui contient une propriété <strong>session</strong>. Cette propriété va nous dire si l'utilisateur est connecté. Si il est bel et bien connecté, on peut faire exactement la même chose que dans la fonction précédente.
Vous pouvez donc copier tout le code contenu dans la fonction <strong>FB.Event.subscribe()</strong> et le coller dans la condition <code>if (response.session) {}</code>.</p>

<p>Il nous reste une dernière chose à faire (la plus facile !), c'est déconnecter l'utilisateur si il clique sur le lien Déconnexion. Pour cela, nous allons faire appel à la fonction <strong>FB.logout()</strong>. Voici le code : </p>

<div class="highlight">
<pre><span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_logout'</span><span class="p">).</span><span class="nx">live</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">FB</span><span class="p">.</span><span class="nx">logout</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_button_box'</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_profile'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">});</span>
</pre>
</div>


<p>Et enfin, le code final contenant les 3 fonctions : </p>

<div class="highlight">
<pre><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="nx">FB</span><span class="p">.</span><span class="nx">Event</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">'auth.login'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">FB</span><span class="p">.</span><span class="nx">api</span><span class="p">(</span><span class="s1">'/me'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span> 

            <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">'http://graph.facebook.com/'</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">'/picture'</span><span class="p">;</span>

            <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_profile_image'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'&lt;img src="'</span> <span class="o">+</span> <span class="nx">url</span> <span class="o">+</span> <span class="s1">'" alt="#" /&gt;'</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_profile_text'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'&lt;p&gt;&lt;a href="'</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">link</span> <span class="o">+</span> <span class="s1">'"&gt;&lt;strong&gt;'</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">'&lt;/strong&gt;&lt;/a&gt;&lt;br /&gt;&lt;a href="#" id="facebook_logout"&gt;Deconnexion&lt;/a&gt;'</span><span class="p">);</span>

            <span class="kd">var</span> <span class="nx">user_data</span> <span class="o">=</span> <span class="s1">'&lt;ul&gt;&lt;li&gt;Votre date de naissance : '</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">birthday</span> <span class="o">+</span> <span class="s1">'&lt;/li&gt;&lt;li&gt;Votre adresse email : '</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">email</span> <span class="o">+</span> <span class="s1">'&lt;/li&gt;&lt;li&gt;Votre bio : '</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">bio</span> <span class="o">+</span> <span class="s1">'&lt;/li&gt;'</span><span class="p">;</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_user_data'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">user_data</span><span class="p">);</span>

            <span class="nx">FB</span><span class="p">.</span><span class="nx">api</span><span class="p">(</span><span class="s1">'/me/posts'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>

                <span class="kd">var</span> <span class="nx">messages</span> <span class="o">=</span> <span class="s1">'&lt;li&gt;Vos 3 derniers statuts : &lt;ul&gt;'</span><span class="p">;</span>

                <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>

                    <span class="nx">messages</span> <span class="o">+=</span> <span class="s1">'&lt;li&gt;'</span> <span class="o">+</span> <span class="nx">value</span><span class="p">.</span><span class="nx">message</span> <span class="o">+</span> <span class="s1">'&lt;/li&gt;'</span><span class="p">;</span>                           
                    <span class="k">return</span> <span class="p">(</span><span class="nx">key</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">);</span>

                <span class="p">});</span> 

                <span class="nx">messages</span> <span class="o">+=</span> <span class="s1">'&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;'</span><span class="p">;</span>

                <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_user_data'</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">messages</span><span class="p">);</span>

            <span class="p">});</span>

        <span class="p">});</span>

        <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_button_box'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_profile'</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>

    <span class="p">});</span>

    <span class="nx">FB</span><span class="p">.</span><span class="nx">getLoginStatus</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">session</span><span class="p">)</span> <span class="p">{</span>

            <span class="nx">FB</span><span class="p">.</span><span class="nx">api</span><span class="p">(</span><span class="s1">'/me'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span> 

                <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">'http://graph.facebook.com/'</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">'/picture'</span><span class="p">;</span>

                <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_profile_image'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'&lt;img src="'</span> <span class="o">+</span> <span class="nx">url</span> <span class="o">+</span> <span class="s1">'" alt="#" /&gt;'</span><span class="p">);</span>
                <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_profile_text'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'&lt;p&gt;&lt;a href="'</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">link</span> <span class="o">+</span> <span class="s1">'"&gt;&lt;strong&gt;'</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">'&lt;/strong&gt;&lt;/a&gt;&lt;br /&gt;&lt;a href="#" id="facebook_logout"&gt;Deconnexion&lt;/a&gt;'</span><span class="p">);</span>

                <span class="kd">var</span> <span class="nx">user_data</span> <span class="o">=</span> <span class="s1">'&lt;li&gt;Votre date de naissance : '</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">birthday</span> <span class="o">+</span> <span class="s1">'&lt;/li&gt;&lt;li&gt;Votre adresse email : '</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">email</span> <span class="o">+</span> <span class="s1">'&lt;/li&gt;&lt;li&gt;Votre bio : '</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">bio</span> <span class="o">+</span> <span class="s1">'&lt;/li&gt;'</span><span class="p">;</span>
                <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_user_data'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">user_data</span><span class="p">);</span>

                <span class="nx">FB</span><span class="p">.</span><span class="nx">api</span><span class="p">(</span><span class="s1">'/me/posts'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>

                    <span class="kd">var</span> <span class="nx">messages</span> <span class="o">=</span> <span class="s1">'&lt;li&gt;Vos 3 derniers statuts : &lt;ul&gt;'</span><span class="p">;</span>

                    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>

                        <span class="nx">messages</span> <span class="o">+=</span> <span class="s1">'&lt;li&gt;'</span> <span class="o">+</span> <span class="nx">value</span><span class="p">.</span><span class="nx">message</span> <span class="o">+</span> <span class="s1">'&lt;/li&gt;'</span><span class="p">;</span>                           
                        <span class="k">return</span> <span class="p">(</span><span class="nx">key</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">);</span>

                    <span class="p">});</span> 

                    <span class="nx">messages</span> <span class="o">+=</span> <span class="s1">'&lt;/ul&gt;&lt;/li&gt;'</span><span class="p">;</span>

                    <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_user_data'</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">messages</span><span class="p">);</span>

                <span class="p">});</span>

            <span class="p">});</span>

            <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_button_box'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_profile'</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>

        <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_logout'</span><span class="p">).</span><span class="nx">live</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

        <span class="nx">FB</span><span class="p">.</span><span class="nx">logout</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>

            <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_button_box'</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">'#facebook_profile'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>

        <span class="p">});</span>

        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

    <span class="p">});</span>         
<span class="p">});</span>
</pre>
</div><p></p>
<div class="page-header">
<h1 id="conclusion">
Conclusion
<small>Ce que vous avez appris et ce que vous pouvez faire maintenant.</small>
</h1>
</div>
<p></p><p>Vous avez maintenant une page en mesure d'authentifier vos utilisateurs avec leur compte Facebook.
Ce n'est pas très compliqué mais comme la documentation est entièrement en anglais, ce n'est pas facile pour tout le monde de comprendre comment fonctionne la Graph API de Facebook.</p>

<p>Au risque de paraître pour un rabat-joie, je vous demande de <strong>respecter la vie privée de vos utilisateurs</strong>. Ne faites rien sans leur consentement <strong>explicite</strong>. Essayez dans la mesure du possible de leur proposer un lien pour se déconnecter de votre site quand ils le souhaitent.</p>

<p>Voici une liste de quelques liens utiles : </p>

<ul>
<li><a href="https://developers.facebook.com/docs/reference/api/">Documentation de la Graph API</a></li>
<li><a href="https://developers.facebook.com/docs/reference/javascript/">Documentation du SDK Javascript</a></li>
<li>[Plugins à intégrer à votre site web (boutons de connexion, J'aime, etc.)]((<a href="https://developers.facebook.com/docs/plugins/">https://developers.facebook.com/docs/plugins/</a>)</li>
<li><a href="https://developers.facebook.com/docs/reference/api/">Propriétés que vous pouvez récupérer via l'API</a></li>
</ul><p></p>
<br>
<div class="page-header">
<h1 id="share">
Ce tutoriel vous a plu ?
<small>Partagez le ou laissez un commentaire :)</small>
</h1>
</div>
<p>Abonnez vous au <a href="http://feeds.feedburner.com/syrinxoontuts">flux RSS</a> des tutoriels pour rester informé.<br>Sinon, n'hésitez pas à laisser un commentaire ou à partage ce tutoriel sur les réseaux sociaux, ça me fait toujours plaisir et m'encourage à continuer mon oeuvre pour un monde meilleur.</p>
<p class="center">
<a href="http://tuts.syrinxoon.net/tuts/authentification-avec-facebook-connect-javascript/comments" class="btn btn-primary btn-large">Ajouter un commentaire</a>
</p>
</div>
</div>
<div class="span3" id="sidebar">
<div class="well">
<ul class="nav nav-list">
<li class="nav-header">Informations</li>
<li><a href="http://tuts.syrinxoon.net/about">Auteur : Nathan Le Ray</a></li>
<li><a href="http://tuts.syrinxoon.net/categories/api">Catégorie : API</a></li>
<li><a href="./Authentification avec Facebook Connect (Javascript) - Syrinxoon Tuts_files/Authentification avec Facebook Connect (Javascript) - Syrinxoon Tuts.html">Création : 11/09/2011</a></li>
<li><a href="http://tuts.syrinxoon.net/tuts/authentification-avec-facebook-connect-javascript/comments">0 commentaires</a></li>
<li class="nav-header">Sommaire</li>
<li><a href="http://tuts.syrinxoon.net/tuts/authentification-avec-facebook-connect-javascript#introduction">Introduction</a></li>
<li><a href="http://tuts.syrinxoon.net/tuts/authentification-avec-facebook-connect-javascript#creation-de-l-application">Création de l'application</a></li>
<li><a href="http://tuts.syrinxoon.net/tuts/authentification-avec-facebook-connect-javascript#installation-des-fichiers-necessaires">Installation des fichiers nécessaires</a></li>
<li><a href="http://tuts.syrinxoon.net/tuts/authentification-avec-facebook-connect-javascript#authentification">Authentification</a></li>
<li><a href="http://tuts.syrinxoon.net/tuts/authentification-avec-facebook-connect-javascript#conclusion">Conclusion</a></li>
<li class="nav-header">Partagez cette page</li>
<li><a href="http://twitter.com/share" class="twitter-share-button" data-hashtags="SyrinxoonTuts" data-lang="fr" data-related="OyoKooN" data-via="Syrinxoon">Tweet</a></li>
<li>
<div class="g-plusone" data-annotation="inline" data-size="tall" data-width="200"></div>
</li>
<li>
<div class="fb-like" data-send="false" data-show-faces="false" data-width="200"></div>
</li>
<li>
<div class="addthis_toolbox addthis_default_style">
<a class="addthis_counter addthis_pill_style"></a>
</div>
</li>
<li class="nav-header">Publicité</li>
<li class="ad">


</li>
<li class="nav-header">Avertissement</li>
<li>Certains des liens présents sur le site contiennent mon id de suivi (Amazon par exemple), ce qui me permet de toucher une petite commission pour chaque vente. Merci pour votre support.</li>
</ul>
</div>
</div>
</section>
<footer class="footer">
<div class="pull-right">
<a href="http://tuts.syrinxoon.net/tuts/authentification-avec-facebook-connect-javascript#">Haut de page</a>
</div>
<div class="pull-left">
<div class="row">
<div class="span2">
<strong>Syrinxoon Tuts © 2013</strong>
</div>
<div class="span2">
<a href="https://twitter.com/#!/OyoKooN">Contact via Twitter (rapide)</a>
<br>

</div>
<div class="span3">
<a href="https://groups.google.com/forum/#!forum/syrinxoontuts">Un problème avec un tutoriel,<br>une question, besoin d'aide ?</a>
</div>
<div class="span2">
<a href="http://tuts.syrinxoon.net/privacy_policy">Politique de confidentialité</a>
<br>
<a href="http://clicky.com/66563991" title="Web Analytics"><img alt="Badge" border="0" src="./Authentification avec Facebook Connect (Javascript) - Syrinxoon Tuts_files/badge.gif" title="Web Analytics"></a>
</div>
</div>
</div>
</footer>
</div>





</body></html>